# .github/workflows/update_weather.yml

name: Update Daily Weather Forecast

on:
  workflow_dispatch: # (수동 실행 버튼)
  schedule:
    # (매일 15:00 UTC에 실행 = 한국 시간 밤 12시)
    - cron: '0 15 * * *' 

jobs:
  update-data:
    runs-on: ubuntu-latest
    steps:
      # 1. GitHub 저장소 코드를 로봇 컴퓨터로 가져옴
      - name: Check out repository
        uses: actions/checkout@v3

      # 2. Python 3.11 설치
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      # 3. 필요한 라이브러리 설치 (requirements.txt 사용)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi
          
      # 4. '예측api.py' 스크립트 실행
      - name: Run Python script to fetch data
        run: python 예측api.py

      # 5. (핵심) 변경된 'today_forecast_3hourly_final.csv' 파일을
      #    GitHub 저장소에 다시 저장(Commit & Push)
      - name: Commit and push if data changed
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "데이터: 매일 날씨 예보 자동 업데이트"
          file_pattern: today_forecast_3hourly_final.csv